<div id="dash-title-bar">
	<div>Welcome, <%= @user.name %></div>
	<a href="<%= logout_url.to_s %>">logout</a>
</div>

<div class="dash-section">
	<% if @code.available? %>
		<div><%= root_url + @code.code if @code %></div>
		<%= @code.time_until_expire.strftime "%H:%M:%S" if !@code.nil?%>
	<% else %>
		<p><%= @code.availability %></p>
	<% end %>

	<%= form_for :new_code, url: new_code_url do |f| %>
		<%= f.submit 'new recruit code', :class => 'submit-button' %>
	<% end %>
</div>

<div class="dash-section">
	<h1>Earnings <%= as_currency @user.earned %></h1>
	<ol>
		<% @user.transactions.each do |transaction| %>
			<li class="transaction-record">
				<div class="currency">+ <%= as_currency transaction.amount @user %></div>
				<div class="reason">from <%= transaction.from %> joining</div>
				<div class="chain"><%= transaction.from %> -&gt; <%= transaction.up_to(@user).join(' -> ') %></div>
			</li>
		<% end %>
	</ol>
	<% if @user.children.length == 0 %>
		<p>you haven't recruited any subordinates yet</p>
	<% end %>
</div>

<div class="dash-section">
	<h1>Your pyramid</h1>
	<div class="tree">
		<ol>
			<li>
				<% if @user.parent %>
					<a><%= @user.parent.name %></a>
				<% end %>
				<%= draw_tree @user.subtree.arrange(:order => :created_at) %>
			</li>
		</ol>
	</div>
</div>
